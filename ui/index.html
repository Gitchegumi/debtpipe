<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DebtPipe ðŸ’¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        body { background-color: #0f172a; color: #f8fafc; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">
    <div class="max-w-6xl mx-auto">
        <header class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-emerald-500 rounded-lg"><i data-lucide="banknote" class="text-white"></i></div>
                <h1 class="text-3xl font-bold tracking-tight">DebtPipe</h1>
            </div>
            <div class="text-sm text-slate-400">Unlimited Debt Simulator</div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: Inputs -->
            <div class="lg:col-span-1 space-y-6">
                <section class="glass p-6 rounded-2xl">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="settings-2" class="w-4 h-4"></i> Strategy
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs uppercase tracking-wider text-slate-400 mb-2 font-semibold">Method</label>
                            <select id="method" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2.5 focus:ring-2 focus:ring-emerald-500 outline-none transition-all">
                                <option value="snowball">Debt Snowball (Smallest Balance First)</option>
                                <option value="avalanche">Debt Avalanche (Highest Interest First)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs uppercase tracking-wider text-slate-400 mb-2 font-semibold">Extra Monthly Payment ($)</label>
                            <input type="number" id="extra" value="500" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2.5 focus:ring-2 focus:ring-emerald-500 outline-none transition-all">
                        </div>
                    </div>
                </section>

                <section class="glass p-6 rounded-2xl">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="list" class="w-4 h-4"></i> Debt List
                    </h2>
                    <p class="text-xs text-slate-400 mb-4">Paste your debts here (Name, Balance, Rate, Min). One per line.</p>
                    <textarea id="debtData" rows="12" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 font-mono text-sm focus:ring-2 focus:ring-emerald-500 outline-none transition-all mb-4">
Credit Card A, 4500, 18.99, 120
Personal Loan, 12000, 8.5, 350
Car Loan, 8000, 5.0, 250
Student Loan, 25000, 4.2, 280</textarea>
                    <div class="flex gap-2">
                        <button onclick="runSimulation()" class="flex-1 bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2 shadow-lg shadow-emerald-900/20">
                            <i data-lucide="play" class="w-4 h-4"></i> Run
                        </button>
                        <button onclick="exportToPDF()" class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2" title="Export to PDF">
                            <i data-lucide="file-text" class="w-4 h-4"></i>
                        </button>
                        <button onclick="clearData()" class="bg-slate-800 hover:bg-rose-900/30 text-slate-400 hover:text-rose-400 py-3 px-4 rounded-lg transition-all" title="Clear All Data">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </section>
            </div>

            <!-- Right Column: Results -->
            <div class="lg:col-span-2 space-y-6" id="report-content">
                <!-- Metrics -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="glass p-6 rounded-2xl border-l-4 border-emerald-500">
                        <div class="text-xs uppercase text-slate-400 font-semibold mb-1">Time to Freedom</div>
                        <div class="text-3xl font-bold" id="metric-months">0 Months</div>
                        <div class="text-sm text-slate-500" id="metric-years">0 Years</div>
                    </div>
                    <div class="glass p-6 rounded-2xl border-l-4 border-rose-500">
                        <div class="text-xs uppercase text-slate-400 font-semibold mb-1">Total Interest</div>
                        <div class="text-3xl font-bold" id="metric-interest">$0.00</div>
                        <div class="text-sm text-slate-500">Paid to banks</div>
                    </div>
                    <div class="glass p-6 rounded-2xl border-l-4 border-blue-500">
                        <div class="text-xs uppercase text-slate-400 font-semibold mb-1">Total Cost</div>
                        <div class="text-3xl font-bold" id="metric-total">$0.00</div>
                        <div class="text-sm text-slate-500">Principal + Interest</div>
                    </div>
                </div>

                <!-- Chart -->
                <section class="glass p-6 rounded-2xl h-[400px]">
                    <canvas id="payoffChart"></canvas>
                </section>

                <!-- Schedule Table -->
                <section class="glass p-6 rounded-2xl">
                    <h2 class="text-lg font-semibold mb-4">Payoff Milestones</h2>
                    <div class="overflow-hidden rounded-xl border border-slate-700">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-slate-800 text-slate-300">
                                <tr>
                                    <th class="p-3 font-semibold">Priority</th>
                                    <th class="p-3 font-semibold">Debt Name</th>
                                    <th class="p-3 font-semibold text-right">Payoff Month</th>
                                </tr>
                            </thead>
                            <tbody id="milestonesBody" class="divide-y divide-slate-700">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        let chartInstance = null;

        // Load persisted data on start
        window.onload = () => {
            const savedData = localStorage.getItem('debtpipe_data');
            const savedExtra = localStorage.getItem('debtpipe_extra');
            const savedMethod = localStorage.getItem('debtpipe_method');
            
            if (savedData) document.getElementById('debtData').value = savedData;
            if (savedExtra) document.getElementById('extra').value = savedExtra;
            if (savedMethod) document.getElementById('method').value = savedMethod;
            
            lucide.createIcons();
            runSimulation();
        };

        function exportToPDF() {
            const element = document.getElementById('report-content');
            const opt = {
                margin:       [10, 10],
                filename:     'DebtPipe_Payoff_Plan.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, backgroundColor: '#0f172a' },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function clearData() {
            if (confirm("Are you sure you want to clear all data? This cannot be undone.")) {
                localStorage.clear();
                location.reload();
            }
        }

        function runSimulation() {
            const rawData = document.getElementById('debtData').value;
            const extraPayment = parseFloat(document.getElementById('extra').value) || 0;
            const method = document.getElementById('method').value;

            // Persist
            localStorage.setItem('debtpipe_data', rawData);
            localStorage.setItem('debtpipe_extra', extraPayment);
            localStorage.setItem('debtpipe_method', method);

            // 1. Parse Data
            const debts = rawData.trim().split('\n').map(line => {
                const [name, balance, rate, min] = line.split(',').map(s => s.trim());
                return {
                    name,
                    balance: parseFloat(balance),
                    interestRate: parseFloat(rate),
                    minPayment: parseFloat(min)
                };
            }).filter(d => !isNaN(d.balance));

            // 2. Sort
            if (method === "snowball") {
                debts.sort((a, b) => a.balance - b.balance);
            } else {
                debts.sort((a, b) => b.interestRate - a.interestRate);
            }

            // 3. Simulate
            const dataPoints = [{ month: 0, balance: debts.reduce((sum, d) => sum + d.balance, 0) }];
            const milestones = [];
            const initialPrincipal = dataPoints[0].balance;
            let totalInterest = 0;
            let currentMonth = 0;
            let currentDebts = JSON.parse(JSON.stringify(debts));
            const monthlyBudget = extraPayment + currentDebts.reduce((sum, d) => sum + d.minPayment, 0);

            while (currentDebts.some(d => d.balance > 0) && currentMonth < 600) {
                currentMonth++;
                let budget = monthlyBudget;

                // Accrue Interest
                currentDebts.forEach(d => {
                    if (d.balance > 0) {
                        const interest = d.balance * ((d.interestRate / 100) / 12);
                        totalInterest += interest;
                        d.balance += interest;
                    }
                });

                // Pay Mins
                currentDebts.forEach(d => {
                    if (d.balance > 0) {
                        const pay = Math.min(d.balance, d.minPayment);
                        d.balance -= pay;
                        budget -= pay;
                    }
                });

                // Apply Snowball to Priority
                for (let d of currentDebts) {
                    if (d.balance > 0 && budget > 0) {
                        const pay = Math.min(d.balance, budget);
                        d.balance -= pay;
                        budget -= pay;
                        
                        if (d.balance === 0) {
                            milestones.push({ name: d.name, month: currentMonth });
                        }
                    }
                }

                dataPoints.push({ month: currentMonth, balance: currentDebts.reduce((sum, d) => sum + d.balance, 0) });
            }

            // 4. Update UI
            document.getElementById('metric-months').innerText = `${currentMonth} Months`;
            document.getElementById('metric-years').innerText = `${(currentMonth/12).toFixed(1)} Years`;
            document.getElementById('metric-interest').innerText = `$${totalInterest.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('metric-total').innerText = `$${(initialPrincipal + totalInterest).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;

            updateMilestones(milestones);
            updateChart(dataPoints);
        }

        function updateMilestones(milestones) {
            const body = document.getElementById('milestonesBody');
            body.innerHTML = milestones.map((m, i) => `
                <tr class="hover:bg-slate-800/50 transition-colors">
                    <td class="p-3 text-slate-500">#${i + 1}</td>
                    <td class="p-3 font-medium">${m.name}</td>
                    <td class="p-3 text-right text-emerald-400 font-mono">Month ${m.month}</td>
                </tr>
            `).join('');
        }

        function updateChart(data) {
            const ctx = document.getElementById('payoffChart').getContext('2d');
            
            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => `Month ${d.month}`),
                    datasets: [{
                        label: 'Remaining Balance',
                        data: data.map(d => d.balance),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#94a3b8', callback: (val) => '$' + val.toLocaleString() }
                        },
                        x: { 
                            grid: { display: false },
                            ticks: { color: '#94a3b8', maxRotation: 0, autoSkip: true, maxTicksLimit: 10 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Init
        lucide.createIcons();
        runSimulation();
    </script>
</body>
</html>
